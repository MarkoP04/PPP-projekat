unit Finalizuj_recept;

interface

uses
  System.SysUtils, System.Types, System.UITypes, System.Classes, System.Variants,
  FMX.Types, FMX.Controls, FMX.Forms, FMX.Graphics, FMX.Dialogs, FMX.Layouts,
  FMX.Objects, FMX.Controls.Presentation, FMX.StdCtrls, FMX.Edit, FireDAC.Stan.Param;

type
  TForm7 = class(TForm)
    Label5: TLabel;
    Label6: TLabel;
    Label4: TLabel;
    Edit1: TEdit;
    Label1: TLabel;
    Edit2: TEdit;
    Label2: TLabel;
    Button1: TButton;
    Button2: TButton;
    procedure Button2Click(Sender: TObject);
    procedure Button1Click(Sender: TObject);
    procedure FormCreate(Sender: TObject);
  private
    { Private declarations }
  public
    PrototipID, recept: Integer;
  end;

var
  Form7: TForm7;

implementation

{$R *.fmx}

uses
Prototipi, Ideje_u;



procedure TForm7.Button1Click(Sender: TObject);
begin

  Form1.FDQueryAction.Close;
  Form1.FDQueryAction.SQL.Text :=
    'INSERT INTO Recepti (ime, recept, prototip_id, cena) VALUES (:pID, :pIme, :pRecept, :pCena)';

  Form1.FDQueryAction.ParamByName('pId').AsInteger := PrototipID;
  Form1.FDQueryAction.ParamByName('pIme').AsString := Edit1.Text;
  Form1.FDQueryAction.ParamByName('pCena').AsInteger := StrToInt(Edit2.Text);
  Form1.FDQueryAction.ParamByName('pRecept').AsInteger := recept;

  try
    Form1.FDQueryAction.ExecSQL;
    ShowMessage('Recept je uspesno napravljen.');
    Form7.Free;
  except
    on E: Exception do
      ShowMessage('Error: ' + E.Message);
  end;
end;

procedure TForm7.Button2Click(Sender: TObject);
begin
  Form7.Free;
end;

procedure TForm7.FormCreate(Sender: TObject);
begin
  Form1.FDQuery1.Close;
  Form1.FDQuery1.SQL.Text :=
    'SELECT ime FROM Prototipi WHERE prototip_id = pID';
  Form1.FDQuery1.ParamByName('id').AsInteger := PrototipID;
  Form1.FDQuery1.Open;
  Label6 := Form1.FDQuery1.FieldByName('ime').AsString;
end;

end.
